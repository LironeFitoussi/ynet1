!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.google_analytics=t())}(this,(function(){"use strict";return function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;if(null===document.currentScript)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});const i=e.flowplayer;return"function"==typeof i?(i(t),t):(Array.isArray(i.extensions)||(i.extensions=[]),~i.extensions.indexOf(t)||i.extensions.push(t),t)}(window,class GoogleAnalyticsPlugin{constructor(e){this.started=!1,this.paused=!1,this.muted=!1,this.once=!0,this.liveflag=!1,this.ga_instances=[],this.ga_extensions=[],this.quartiles=[0,0,0],this.ad_type="preroll",this.preroll_counter=0,this.midroll_counter=0,this.postroll_counter=0,this.event_categories={live:"Live",videos:"Videos"},this.event_actions={fullscreen_enter:"fullscreen_enter",fullscreen_exit:"fullscreen_exit",video_player_load:"video_player_load",video_start:"video_start",video_click_play:"video_click_play",video_pause:"video_pause",video_resume:"video_resume",video_mute:"video_mute",video_unmute:"video_unmute",video_25_percent:"video_25_percent",video_50_percent:"video_50_percent",video_75_percent:"video_75_percent",video_complete:"video_complete",live_start:"live_start",live_click_play:"live_click_play",live_pause:"live_pause",live_resume:"live_resume",live_mute:"live_mute",live_unmute:"live_unmute",live_complete:"live_complete",ad_start_preroll:"ad_start_preroll",ad_start_midroll:"ad_start_midroll",ad_start_postroll:"ad_start_postroll",ad_completed_preroll:"ad_completed_preroll",ad_completed_midroll:"ad_completed_midroll",ad_completed_postroll:"ad_completed_postroll",ad_skipped_preroll:"ad_skipped_preroll",ad_skipped_midroll:"ad_skipped_midroll",ad_skipped_postroll:"ad_skipped_postroll",ad_break_completed:"ad_break_completed"},this.flowplayer=e}init(e,t,i){var s;if(this.config=e,this.video=i,"object"!=typeof e.ga)return;if(i.hasState("consent-no-tracking"))return;const a=(null===(s=this.flowplayer.ads)||void 0===s?void 0:s.events)||{AD_STARTED:"ad-started",AD_COMPLETED:"ad-completed",AD_SKIPPED:"ad-skipped",AD_BREAK_COMPLETED:"ad-break-completed"};this.muted=i.muted||!1,this.media_title=e.ga.media_title||"unknown video title",this.ga_instances=e.ga.ga_instances,e.ga.event_actions&&(this.event_actions=e.ga.event_actions),e.ga.event_categories&&(this.event_categories=e.ga.event_categories),i.on(["mount","timeupdate","loadstart","ended","seeked","seeking","pause","playing","volumechange",a.AD_STARTED,a.AD_COMPLETED,a.AD_SKIPPED,a.AD_BREAK_COMPLETED,"config","click","touchend","fullscreenenter","fullscreenexit"],e=>{switch(e.type){case"playing":this.playing(e.type);break;case"pause":this.pause();break;case"mount":this.loaded();break;case"timeupdate":this.progress();break;case"ended":this.ended();break;case"volumechange":this.volumechange();break;case"ad-started":this.adstarted(e);break;case"ad-completed":this.adcompleted(e);break;case"ad-break-completed":this.adbreakcompleted(e.type);break;case"config":this.configured(e);break;case"click":this.click();break;case"fullscreenenter":this.fullscreenenter();break;case"fullscreenexit":this.fullscreenexit();break;case"ad-skipped":this.adskipped()}})}setup_ga(){window.ga&&0===this.ga_extensions.length&&this.ga_instances.forEach((e,t)=>{var i;window.ga("create",e,"auto","ext"+(t+1)),(null===(i=this.config)||void 0===i?void 0:i.ga.custom_data)&&window.ga("ext"+(t+1)+".set",this.config.ga.custom_data),this.ga_extensions.push("ext"+(t+1))})}set_started(e){var t;(null===(t=this.config)||void 0===t?void 0:t.ga.start_on)===e&&(this.liveflag?this.track(this.event_actions.live_start):this.track(this.event_actions.video_start),this.started=!0)}click(){!this.paused&&this.started||(this.liveflag?this.track(this.event_actions.live_click_play):this.track(this.event_actions.video_click_play))}playing(e){this.started?this.paused&&(this.paused=!1,this.liveflag?this.track(this.event_actions.live_resume):this.track(this.event_actions.video_resume)):this.set_started(e)}pause(){this.video&&(Math.abs(this.video.duration-this.video.currentTime)<1||!this.started||(this.paused=!0,this.liveflag?this.track(this.event_actions.live_pause):this.track(this.event_actions.video_pause)))}loaded(){}progress(){!this.liveflag&&this.video&&(this.video.currentTime/this.video.duration>.25&&0===this.quartiles[0]?(this.quartiles[0]=1,this.track(this.event_actions.video_25_percent)):this.video.currentTime/this.video.duration>.5&&0===this.quartiles[1]?(this.quartiles[1]=1,this.track(this.event_actions.video_50_percent)):this.video.currentTime/this.video.duration>.75&&0===this.quartiles[2]&&(this.quartiles[2]=1,this.track(this.event_actions.video_75_percent)))}volumechange(){this.video&&(this.video.muted&&!this.muted?(this.muted=!0,this.liveflag?this.track(this.event_actions.live_mute):this.track(this.event_actions.video_mute)):!this.video.muted&&this.muted&&(this.muted=!1,this.liveflag?this.track(this.event_actions.live_unmute):this.track(this.event_actions.video_unmute)))}ended(){this.started&&(this.liveflag?this.track(this.event_actions.live_complete):this.track(this.event_actions.video_complete)),this.reset()}reset(){this.started=!1,this.quartiles=[0,0,0],this.once=!0,this.config&&(this.config.ga.start_on="playing"),this.preroll_counter=0,this.midroll_counter=0,this.postroll_counter=0}configured(e){this.config&&this.video&&(e.data&&(e.data.live&&(this.liveflag=!0),e.data.title?this.media_title=e.data.title:e.data.metadata&&e.data.metadata.title&&(this.media_title=e.data.metadata.title)),this.config.ga.start_on||(this.config.ga.start_on="playing"),this.video.ads||(this.config.ga.start_on="playing"),this.once&&(this.once=!1,this.track(this.event_actions.video_player_load)))}fullscreenenter(){this.track(this.event_actions.fullscreen_enter)}fullscreenexit(){this.track(this.event_actions.fullscreen_exit)}checkForAdCounter(e,t){return e.replace("[x]",t+"")}adstarted(e){var t;switch((null===(t=e.data)||void 0===t?void 0:t.ad_type)||"preroll"){case"midroll":this.ad_type="midroll",this.midroll_counter++,this.track(this.checkForAdCounter(this.event_actions.ad_start_midroll,this.midroll_counter));break;case"postroll":this.ad_type="postroll",this.postroll_counter++,this.track(this.checkForAdCounter(this.event_actions.ad_start_postroll,this.postroll_counter));break;default:this.ad_type="preroll",this.preroll_counter++,this.track(this.checkForAdCounter(this.event_actions.ad_start_preroll,this.preroll_counter))}}adcompleted(e){var t;switch((null===(t=e.data)||void 0===t?void 0:t.ad_type)||"preroll"){case"midroll":this.track(this.event_actions.ad_completed_midroll);break;case"postroll":this.track(this.event_actions.ad_completed_postroll);break;default:this.track(this.event_actions.ad_completed_preroll)}}adskipped(){if(this.ad_type)switch(this.ad_type){case"midroll":this.track(this.event_actions.ad_skipped_midroll);break;case"postroll":this.track(this.event_actions.ad_skipped_postroll);break;default:this.track(this.event_actions.ad_skipped_preroll)}else this.track(this.event_actions.ad_skipped_preroll)}adbreakcompleted(e){this.set_started(e),this.track(this.event_actions.ad_break_completed)}pushToDataLayer(e,t){var i;if(window.dataLayer)try{window.dataLayer.push({event:"Flowplayer",video_name:this.media_title,action:e,category:t,duration:null===(i=this.video)||void 0===i?void 0:i.duration})}catch(e){}}track(e){let t=this.event_categories.videos;this.liveflag&&(t=this.event_categories.live),e&&t&&(this.config&&this.config.ga&&this.config.ga.data_layer_tracking?this.pushToDataLayer(e,t):(this.setup_ga(),this.ga_extensions.length&&void 0!==window.ga&&null!==window.ga?this.ga_extensions.forEach(i=>{window.ga(i+".send","event",t,e,this.media_title)}):console.debug("ga console.send","event",t,e,this.media_title)))}})}));
