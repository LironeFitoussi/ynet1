!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.float_on_scroll=t())}(this,(function(){"use strict";const e="float:pop:in";var t=Object.freeze({__proto__:null,POP_IN:e,POP_OUT:"float:pop:out"});const n=(e,t)=>new(((e,t)=>{const n=e.get(t);if(!n)throw new Error(`no flowplayer component with the name ${t} exists`);const o=window.customElements.get(t);if(!o)throw new Error(`no default flowplayer component with the name ${t} exists`);const i=window.customElements.get(n);return"function"!=typeof i?o:i})(e._customElements,t))(e),o=(e,t,n)=>{window.customElements.get(t)||window.customElements.define(t,n),e.customElements.get(t)||e.customElements.set(t,t)};function i(e){return function(e){const t=e.getBoundingClientRect(),n=window.innerHeight,o=t.y;return o>n||o+t.height<0?0:t.y<0?(t.height+o)/t.height:n-t.y>t.height?1:Math.abs((n-t.y)/t.height)}(e)>.8}function l(t,n,o){0!=o.reaper&&o.floating&&s(o,n,e)}function r(e,t,o){const i=document.createElement("div");return i.classList.add("fp-exit-float"),i.append(Object.assign(n(e,"flowplayer-close-icon"),{role:"button"})),i.addEventListener("click",()=>{o.was_user_toggled=!0,e.togglePlay(!1),l(0,t,e)}),i}function s(t,n,o){o&&t.emit(o),setTimeout((function(){const i=n.querySelector(".fp-float-wrapper"),l=n.clientWidth/n.clientHeight;if(!i)return;i.style.height=o===e?"auto":i.clientWidth/l+"px";const r=i.querySelector(".fp-ad-container > div");r&&(r.style.position=o==e?"absolute":"static"),t.emit("resize",{contentRect:{height:o===e?n.clientHeight:i.clientHeight,width:i.clientWidth}})}))}class FlowplayerComponent extends HTMLElement{constructor(e){super(),this.player=e}}class FlowplayerIcon extends FlowplayerComponent{constructor(e,t){super(e),this.classList.add("fp-icon",t.name),t.title&&this.setAttribute("title",t.title),t.title&&this.setAttribute("aria-label",t.title),t.translation_key&&this.setAttribute("aria-label",e.i18n(t.translation_key)),this.setAttribute("tabindex","0"),this.setAttribute("focusable","true")}}const a={translation_key:"core.mute",name:"fp-mute"},c={translation_key:"core.mute",name:"fp-unmute"},u={translation_key:"core.close",name:"fp-close"};class FloatOnScroll{constructor(e){this.flowplayer=e,o(this.flowplayer,"flowplayer-mute-icon",class extends FlowplayerIcon{constructor(e){super(e,a)}}),o(this.flowplayer,"flowplayer-unmute-icon",class extends FlowplayerIcon{constructor(e){super(e,c)}}),o(this.flowplayer,"flowplayer-close-icon",class extends FlowplayerIcon{constructor(e){super(e,u)}})}init(t,o,a){if(t.multiplay||!1===t.float_on_scroll)return;if(function(){try{return window.self!==window.top}catch(e){return!0}}())return console.warn("iframe detected - floating player not supported in iframe");t.autopause&&a.setOpts({autopause:!1});const c={pop_out_container:void 0,was_user_toggled:!1},u=window.scrollY;a.on("mount",(function(){c.pop_out_container=function(e,t){const n=document.createElement("div");return n.classList.add("fp-float-wrapper"),e.appendChild(n),Array.from(e.childNodes).forEach((function(e){e instanceof Element&&(e===n||e.classList.contains("fp-ratio"))||n.appendChild(e)})),t.getFullsceenTarget=()=>n,n}(o,a)})),a.on("renderplugin",(function(e){var t;e.preventDefault(),e.detail&&(null===(t=c.pop_out_container)||void 0===t||t.append(e.detail));const n=e.detail.controls;n&&n.append(r(a,o,c))}));const p=function(e,t){const n=e._customElements.get(t);return n&&e.root.querySelector(n)||void 0}(a,"flowplayer-header");p&&function(e,t,o,i){const l=document.createElement("div");l.classList.add("fp-mute-float"),l.append(...Object.assign([n(i,"flowplayer-mute-icon"),n(i,"flowplayer-unmute-icon")],{role:"button"})),l.addEventListener("click",(function(){i.toggleMute()})),e.append(r(i,o,t),l)}(p,c,o,a);const f=function(e,t){const n=e||60,o=Math.ceil(1e3/n);let i=Date.now(),l=-1;return function(...e){return l>-1||Date.now()<i||(l=requestAnimationFrame((function(){l=-1,t(),i=Date.now()+o}))),l}}(0,(function(){if(i(o)){if(a.hasState("is-fullscreen"))return;l(0,o,a)}})),d=function(){s(a,o)};a.on("viewleave",e=>{window.scrollY!==u&&function(e){return!e.paused||!(!e.ads||!e.ads.adPlaying)}(a)&&!c.was_user_toggled&&(e.preventDefault(),function(e,t,n){0==n.reaper||n.floating||s(n,t,"float:pop:out")}(0,o,a))}),a.on("viewenter",(function(){c.was_user_toggled=!1})),a.on("float:pop:out",(function(){window.addEventListener("scroll",f),a.floating=!0,a.setState("is-popped-out",!0),window.addEventListener("resize",d)})),a.on(e,(function(){window.removeEventListener("scroll",f),a.floating=!1,a.setState("is-popped-out",!1),window.removeEventListener("resize",d)}))}}return FloatOnScroll.events=t,function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;if(null===document.currentScript)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});const n=e.flowplayer;return"function"==typeof n?(n(t),t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t),t)}(window,FloatOnScroll)}));
